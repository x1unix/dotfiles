#!/usr/bin/env sh
DEFAULT_COMP_MODEL='StarCoder2-3B'
DEFAULT_CHAT_MODEL='Qwen2-1.5B-Instruct'

COMP_MODEL="${COMP_MODEL:-$DEFAULT_COMP_MODEL}"
CHAT_MODEL="${CHAT_MODEL:-$DEFAULT_CHAT_MODEL}"

EXTRA_ARGS=''

export TABBY_WEBSERVER_JWT_TOKEN_SECRET='c482b41b-ab94-4ae8-b592-619a6c05c0ea'

case "$1" in 
  '-h' | '--help' | 'help')
    echo "Usage: CHAT_MODEL=<chat model> COMP_MODEL=<code completion model> $0"
    exit
    ;;
  *)
    ;;
esac

if [ `uname -s` == 'Darwin' ]; then
  echo '[INFO] Apple detected'
  EXTRA_ARGS='--device=metal --chat-device=metal --parallelism=2'
fi

tabby serve --model "$COMP_MODEL" --chat-model "$CHAT_MODEL" --host=127.0.0.1 $EXTRA_ARGS

